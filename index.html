<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>BookKaro Staff - Management</title>
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getFirestore, collection, onSnapshot, doc, updateDoc } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

        const firebaseConfig = {
            apiKey: "AIzaSyAL-LDI6qvDPqVWNL_tNb53D7kacbpAlAw",
            authDomain: "bookkaro-f549a.firebaseapp.com",
            projectId: "bookkaro-f549a",
            storageBucket: "bookkaro-f549a.firebasestorage.app",
            messagingSenderId: "1067243117950",
            appId: "1:1067243117950:web:c7682b0aca89d0c0a0272f"
        };

        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);

        window.staffLogin = () => {
            const name = document.getElementById('staffName').value;
            if(!name) return alert("Enter Staff Name");
            document.getElementById('loginDiv').style.display = 'none';
            document.getElementById('mainDiv').style.display = 'block';
            document.getElementById('sessionInfo').innerText = `Staff: ${name} | Login: ${new Date().toLocaleTimeString()}`;
        };

        onSnapshot(collection(db, "bookings"), (snap) => {
            const containers = { Pending: '', Approved: '', Rejected: '', Alternate: '' };
            snap.forEach(d => {
                const b = d.data();
                const card = `<div class="card">
                    <strong>${b.name}</strong> (${b.propertyType})<br>
                    <small>${b.stayLoc} | ${b.checkin} to ${b.checkout}</small><br>
                    ${b.status === 'Pending' ? `
                        <button onclick="updateStatus('${d.id}', 'Approved')">Approve ✔</button>
                        <button onclick="handleReject('${d.id}', '${b.preference}')">Reject ✖</button>` : ''}
                    ${b.status === 'Alternate' ? `<br><em>Alt Offered: ${b.altText}</em>` : ''}
                </div>`;
                containers[b.status] += card;
            });
            ['Pending', 'Approved', 'Rejected', 'Alternate'].forEach(s => document.getElementById(s.toLowerCase()).innerHTML = containers[s]);
        });

        window.updateStatus = async (id, status) => await updateDoc(doc(db, "bookings", id), { status });
        window.handleReject = async (id, pref) => {
            const alt = prompt(`Guest Preference: "${pref}"\nEnter alternate option to move to Alternate Offers:`);
            if(alt) await updateDoc(doc(db, "bookings", id), { status: 'Alternate', altText: alt });
            else await updateDoc(doc(db, "bookings", id), { status: 'Rejected' });
        };
    </script>
    <style>
        body { background-color: #efebe9; font-family: sans-serif; color: #4e342e; }
        .column { float: left; width: 23%; margin: 1%; background: #d7ccc8; padding: 10px; border-radius: 10px; min-height: 80vh; }
        .card { background: #fff; padding: 10px; margin: 10px 0; border-radius: 5px; border-left: 5px solid #8d6e63; font-size: 13px; }
        #loginDiv { text-align: center; margin-top: 100px; }
        button { background: #8d6e63; color: white; border: none; padding: 5px; margin: 5px; cursor: pointer; }
    </style>
</head>
<body>
    <div id="loginDiv">
        <h2>BookKaro Staff Portal</h2>
        <input type="text" id="staffName" placeholder="Staff Name">
        <input type="text" placeholder="Staff ID">
        <input type="password" placeholder="Passcode">
        <button onclick="staffLogin()">Enter Dashboard</button>
    </div>
    <div id="mainDiv" style="display:none;">
        <h3 id="sessionInfo" style="text-align:center"></h3>
        <div class="column"><h4>Pending</h4><div id="pending"></div></div>
        <div class="column"><h4>Approved</h4><div id="approved"></div></div>
        <div class="column"><h4>Rejected</h4><div id="rejected"></div></div>
        <div class="column"><h4>Alternate Offers</h4><div id="alternate"></div></div>
    </div>
</body>
</html>
